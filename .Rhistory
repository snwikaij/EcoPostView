line = element_blank(),
text = element_blank(),
plot.margin = unit(c(0,0,0,0), "mm"))
ggsave(final_fig, filename="C:/Users/admin/OneDrive/Bureaublad/Paper3/Figures/Fig2_method.jpeg", units = "mm", width = 180, height = 210, dpi = 300)
final_fig <- ggplot(data.frame(a=1)) + xlim(0, 90) + ylim(0, 160) +
annotation_custom(ggplotGrob(step1fig), xmin = 0, xmax = 40, ymin = 143, ymax = 168) +
annotation_custom(ggplotGrob(step2fig), xmin = 50, xmax = 90, ymin = 133, ymax = 163)+
annotation_custom(ggplotGrob(eqfigbelow), xmin = 51, xmax = 91, ymin = 128, ymax = 133)+
annotation_custom(ggplotGrob(step3fig), xmin = 0, xmax = 40, ymin = 121, ymax = 136)+
annotation_custom(ggplotGrob(step4fig), xmin = 0, xmax = 40, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step5fig), xmin = 50, xmax = 90, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step6fig), xmin = 5, xmax = 85, ymin = 65, ymax = 85) +
annotation_custom(ggplotGrob(step7fig), xmin = 20, xmax = 70, ymin = 43, ymax = 68) +
annotation_custom(ggplotGrob(step8fig), xmin = 30, xmax = 60, ymin = 20, ymax = 43) +
annotation_custom(ggplotGrob(step9fig), xmin = 10, xmax = 80, ymin = -5, ymax = 20) +
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(39,39,51,51), y = c(150, 150, 145, 145)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(51,51,39,39), y = c(130, 130, 125, 125)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,20,20), y = c(120, 120, 130, 130)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,40,40), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(75,75,56,56), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
theme_void()+
theme(rect = element_blank(),
line = element_blank(),
text = element_blank(),
plot.margin = unit(c(0,0,0,0), "mm"))
ggsave(final_fig, filename="C:/Users/admin/OneDrive/Bureaublad/Paper3/Figures/Fig2_method.jpeg", units = "mm", width = 180, height = 210, dpi = 300)
final_fig <- ggplot(data.frame(a=1)) + xlim(0, 90) + ylim(0, 160) +
annotation_custom(ggplotGrob(step1fig), xmin = 0, xmax = 40, ymin = 143, ymax = 168) +
annotation_custom(ggplotGrob(step2fig), xmin = 50, xmax = 90, ymin = 133, ymax = 163)+
annotation_custom(ggplotGrob(eqfigbelow), xmin = 51, xmax = 91, ymin = 128, ymax = 133)+
annotation_custom(ggplotGrob(step3fig), xmin = 0, xmax = 40, ymin = 121, ymax = 136)+
annotation_custom(ggplotGrob(step4fig), xmin = 0, xmax = 40, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step5fig), xmin = 50, xmax = 90, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step6fig), xmin = 5, xmax = 85, ymin = 65, ymax = 85) +
annotation_custom(ggplotGrob(step7fig), xmin = 20, xmax = 70, ymin = 43, ymax = 68) +
annotation_custom(ggplotGrob(step8fig), xmin = 30, xmax = 60, ymin = 20, ymax = 43) +
annotation_custom(ggplotGrob(step9fig), xmin = 10, xmax = 80, ymin = -5, ymax = 20) +
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(39,39,51,51), y = c(150, 150, 145, 145)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(51,51,39,39), y = c(130, 130, 125, 125)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,20,20), y = c(125, 125,110, 110)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,40,40), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(75,75,56,56), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
theme_void()+
theme(rect = element_blank(),
line = element_blank(),
text = element_blank(),
plot.margin = unit(c(0,0,0,0), "mm"))
ggsave(final_fig, filename="C:/Users/admin/OneDrive/Bureaublad/Paper3/Figures/Fig2_method.jpeg", units = "mm", width = 180, height = 210, dpi = 300)
final_fig <- ggplot(data.frame(a=1)) + xlim(0, 90) + ylim(0, 160) +
annotation_custom(ggplotGrob(step1fig), xmin = 0, xmax = 40, ymin = 143, ymax = 168) +
annotation_custom(ggplotGrob(step2fig), xmin = 50, xmax = 90, ymin = 133, ymax = 163)+
annotation_custom(ggplotGrob(eqfigbelow), xmin = 51, xmax = 91, ymin = 128, ymax = 133)+
annotation_custom(ggplotGrob(step3fig), xmin = 0, xmax = 40, ymin = 121, ymax = 136)+
annotation_custom(ggplotGrob(step4fig), xmin = 0, xmax = 40, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step5fig), xmin = 50, xmax = 90, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step6fig), xmin = 5, xmax = 85, ymin = 65, ymax = 85) +
annotation_custom(ggplotGrob(step7fig), xmin = 20, xmax = 70, ymin = 43, ymax = 68) +
annotation_custom(ggplotGrob(step8fig), xmin = 30, xmax = 60, ymin = 20, ymax = 43) +
annotation_custom(ggplotGrob(step9fig), xmin = 10, xmax = 80, ymin = -5, ymax = 20) +
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(39,39,51,51), y = c(150, 150, 145, 145)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(51,51,39,39), y = c(130, 130, 125, 125)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,20,20), y = c(123, 123,115, 115)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,40,40), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(75,75,56,56), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
theme_void()+
theme(rect = element_blank(),
line = element_blank(),
text = element_blank(),
plot.margin = unit(c(0,0,0,0), "mm"))
ggsave(final_fig, filename="C:/Users/admin/OneDrive/Bureaublad/Paper3/Figures/Fig2_method.jpeg", units = "mm", width = 180, height = 210, dpi = 300)
final_fig <- ggplot(data.frame(a=1)) + xlim(0, 90) + ylim(0, 160) +
annotation_custom(ggplotGrob(step1fig), xmin = 0, xmax = 40, ymin = 143, ymax = 168) +
annotation_custom(ggplotGrob(step2fig), xmin = 50, xmax = 90, ymin = 133, ymax = 163)+
annotation_custom(ggplotGrob(eqfigbelow), xmin = 51, xmax = 91, ymin = 128, ymax = 133)+
annotation_custom(ggplotGrob(step3fig), xmin = 0, xmax = 40, ymin = 121, ymax = 136)+
annotation_custom(ggplotGrob(step4fig), xmin = 0, xmax = 40, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step5fig), xmin = 50, xmax = 90, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step6fig), xmin = 5, xmax = 85, ymin = 65, ymax = 85) +
annotation_custom(ggplotGrob(step7fig), xmin = 20, xmax = 70, ymin = 43, ymax = 68) +
annotation_custom(ggplotGrob(step8fig), xmin = 30, xmax = 60, ymin = 20, ymax = 43) +
annotation_custom(ggplotGrob(step9fig), xmin = 10, xmax = 80, ymin = -5, ymax = 20) +
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(39,39,51,51), y = c(150, 150, 145, 145)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(51,51,38,38), y = c(131, 131, 125, 125)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,20,20), y = c(123, 123,115, 115)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,40,40), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(75,75,56,56), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
theme_void()+
theme(rect = element_blank(),
line = element_blank(),
text = element_blank(),
plot.margin = unit(c(0,0,0,0), "mm"))
ggsave(final_fig, filename="C:/Users/admin/OneDrive/Bureaublad/Paper3/Figures/Fig2_method.jpeg", units = "mm", width = 180, height = 210, dpi = 300)
pl7 <- ggplot(df7, aes(xi, y=y))+
geom_point(size=1, alpha=0.1)+xlab("Inverse of the sample size (1/n)\nand standard error (1/se)")+
ylab("Posterior mean model residuals")+
annotate("text", x=0.11, y=0.6, size=3, label="Residual bias check")+ylim(-.7, .7)+
geom_hline(yintercept = 0, col="dodgerblue1")+
#geom_line(data=df6, aes(xi, y), lwd=1)+
theme_classic()+
theme(axis.title = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank())
step7fig <- cowplot::plot_grid(title_pl7, pl7, ncol=1, rel_heights = c(0.25, 0.75))
title_pl8 <- ggplot()+theme_void()+annotate("text", 0, 0, size = 6, label="Step 8")
text_pl8 <- ggplot() +
theme_void() +
theme(plot.margin = unit(c(.1, .1, .1, .1), "cm")) +
annotate("text",
x = 0,
y = 0,
size = 3,
label = "Sensitivity analysis")
df8 <- data.frame(x=c(1,2), mu=c(-0.2, -0.4), ll=c(-1.2, -1.4), ul=c(0.8, 0.6))
pl8 <- ggplot(df8, aes(x=x, y=mu))+xlim(0, 3)+
geom_point(size=3)+coord_flip()+
geom_hline(yintercept = 0)+
geom_errorbar(aes(ymin=ll, ymax=ul), lwd=1.2, width=0)+
theme_void()
step8fig  <- cowplot::plot_grid(title_pl8, text_pl8, pl8, ncol = 1, rel_heights = c(0.25, 0.2, 0.55))
xvals     <- seq(-1, 1, 0.01)
postbox   <- dnorm(xvals, -0.2, 0.07)
df9       <- data.frame(x=xvals, posterior=postbox)
pointdata <- cbind.data.frame(point=-0.2, ll=-0.2+0.07*-1.9, ul=-0.2+0.07*1.9)
title_pl9 <- ggplot()+theme_void()+annotate("text", 0, 0, size = 6, label="Step 9")
pl9a <- ggplot(df9, aes(x, posterior))+
geom_line()+theme_classic()+ylab("Posterior\nprobability density")+
xlab(expression("Pooled stressor parameter estimate " * beta[s*","*pooled]))+
geom_vline(xintercept = 0, lty=2, lwd=0.2)+
geom_point(data=pointdata, aes(x=point, y=0), size=2, inherit.aes = F)+
geom_errorbarh(data=pointdata, aes(x=0, xmin=ll, xmax=ul, y=0),
height=0, lwd=1)+
theme(axis.ticks = element_blank(),
axis.text = element_blank(),
axis.title = element_blank())
x    <- seq(1, 10, .1)
library(ggplot2)
library(gridExtra)
library(grid)
library(bezier)
set.seed(123)
x   <- seq(1, 10, .5)
ylog <- rpois(length(x), exp(-0.2*x+3.5))
phi <- 10
eta    <- plogis(exp(-0.2*x+1.5))
ylogit <- rbeta(length(x), eta*phi, (1-eta)*phi)
ylog_line   <- exp(-0.2*x+3.5)
ylogit_line <- plogis(exp(-0.2*x+1.5))
#######
#Step1#
#######
df  <- data.frame(x, ylog, ylogit, ylog_line, ylogit_line)
df2 <- df[,c(1,2,3)]
colnames(df2) <- c("x", "Log-linear", "Logit-linear")
df3 <- tidyr::gather(df2, "key", "y", -c(x))
title_pl1 <- ggplot()+theme_void()+annotate("text", 0, 0, size = 6, label="Step 1")
pl1 <- ggplot(df3, aes(x, y))+
geom_point(size=1)+
theme_classic()+
facet_wrap(.~key, scales = "free_y")+
theme(axis.title = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
strip.text.x = element_text(size = 7, margin = margin(t = 1.5, b = 1.5)),
panel.spacing = unit(0.1, "lines"))
step1fig <- cowplot::plot_grid(title_pl1, pl1, ncol=1, rel_heights = c(0.25, 0.75))
#######
#Step2#
#######
df4           <- df[,c(1,4,5)]
colnames(df4) <- c("x", "Log-linear", "Logit-linear")
df4 <- tidyr::gather(df4, "key", "y", -c(x))
pl2 <- ggplot(df3, aes(x, y))+
geom_point(size=1)+
theme_classic()+
geom_line(data=df4, aes(x,y), lwd=1)+
facet_wrap(.~key, scales = "free_y")+
theme(axis.title.y = element_blank(),
axis.title.x = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
strip.text.x = element_text(size = 7, margin = margin(t = 1.5, b = 1.5)),
panel.spacing = unit(0.1, "lines"))
title_pl2 <- ggplot()+theme_void()+annotate("text", 0, 0, size = 6, label="Step 2")
logeq <- ggplot() +
theme_void() +
annotate("text",
x = 0,
y = 0,
size = 2.5,
label = expression(Ln(E(y)) == beta[0] +
sum(beta[s], s == 1, n) %*% Ln(x[s])))
logiteq <- ggplot() +
theme_void() +
annotate("text",
x = 0,
y = 0,
size = 2.5,
label = expression(Logit(E(y)) == beta[0] +
sum(beta[s], s == 1, n) %*% Ln(x[s])))
step2fig <- cowplot::plot_grid(title_pl2, pl2,  ncol=1, rel_heights = c(0.25, 0.75))
eqfigbelow <- cowplot::plot_grid(logeq, logiteq, ncol=2)
#######
#Step3#
#######
title_pl3 <- ggplot()+theme_void()+annotate("text", 0, 0, size = 6, label="Step 3")
text_pl3 <- ggplot() +
theme_void() +
annotate("text",
x = 0,
y = 0,
size = 3,
label = expression("Likelihood: " ~ italic(f)*"("*Data ~ "|" ~ beta[s]*")" ~ "=" ~ beta[s] ~ "=" ~ "{" ~ beta[s*","*i] ~ ", ..., " ~ beta[s*","*n] ~ "}"))
step3fig  <- cowplot::plot_grid(title_pl3, text_pl3, ncol = 1)
########
#Step 4#
########
set.seed(123)
z1 <- rnorm(300, 0, 1)
z2 <- rnorm(300, 0, 2)
df4       <- data.frame(mu=z1, se=abs(z2), prec=1/abs(z2), eff=z1/abs(z2))
title_pl4 <- ggplot()+theme_void()+annotate("text", 0, 0, size = 6, label="Step 4")
pl4a <- ggplot(df4, aes(eff, prec))+
geom_point(size=1, alpha=0.1)+xlim(-5, 5)+ylim(.3, 5)+
annotate("text", x=2, y=3.5, size=3, label="Egger's test")+
geom_vline(xintercept=0, lty=2, lwd=0.6)+
#xlab("Parameter estimate/se")+
#ylab("Precision \n1/se")+
theme_classic()+
theme(
axis.ticks = element_blank(),
axis.title = element_blank(),
axis.text = element_blank())
pl4b <- ggplot(data.frame(z=z1), aes(x=z))+
geom_histogram(col='black', fill="grey80", lwd=0.1, size=0.1, alpha=0.1, bins=20)+
annotate("text", x=1.3, y=25, size=3, label="Check\nz-distribution")+
#xlab("z-value")+
#ylab("Count")+
theme_classic()+
theme(
axis.title = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank())
step4fig <- cowplot::plot_grid(title_pl4, cowplot::plot_grid(pl4a, pl4b), ncol=1, rel_heights = c(0.25, 0.75))
#######
#Step5#
#######
title_pl5 <- ggplot()+theme_void()+annotate("text", 0, 0, size = 6, label="Step 5")
text_pl5  <- ggplot() +
theme_void() +
theme(plot.margin = unit(c(.1, .1, .1, .1), "cm")) +
ylim(-0.08, 0.08) +
annotate("text", x = 0, y = 0.05, size = 4, label = expression("Prior 1: " ~ italic(f)[M == 1] * "(" * beta[s*","*pooled] * "|Info)")) +
annotate("text", x = 0, y = 0, size = 4, label = "...")+
annotate("text", x = 0, y = -0.05, size = 4, label = expression("Prior 4: " ~ italic(f)[M == 4] * "(" * beta[s*","*pooled] * "|Info)"))
step5fig  <- cowplot::plot_grid(title_pl5, text_pl5, ncol = 1, rel_heights = c(0.25, 0.75))
#########
#Step 6.#
#########
title_pl6 <- ggplot()+theme_void()+annotate("text", 0, 0, size = 6, label="Step 6")
text_pl6a <- ggplot() +
theme_void() +
theme(plot.margin = unit(c(.1, .1, .1, .1), "cm")) +
annotate("text",
x = 0,
y = 0,
size = 3,
label = expression(
"Posterior:" ~italic(f)*"(" * beta[s*","*pooled] * " | Data, Info"*") = " *
frac(
~italic(f)(Data * "|" *  ~beta[s*","*pooled]) %*% ~italic(f)[M](beta[s*","*pooled] * "|" * Info),
sum(~italic(f)(Data * "|" *  ~beta[s*","*pooled]) %*% ~italic(f)[M](beta[s*","*pooled] * "|" * info), M == 1, K))))
text_pl6b <- ggplot() +
theme_void() +
theme(plot.margin = unit(c(.1, .1, 1, .1), "mm")) +
annotate("text",
x = 0,
y = 0,
size = 3,
label = expression(beta[s*","*i] == beta[s*","*pooled] + u[s*","*i]))
combi6    <- cowplot::plot_grid(text_pl6a, text_pl6b, ncol = 2, rel_widths = c(0.75, 0.25))
step6fig  <- cowplot::plot_grid(title_pl6, combi6, ncol = 1, rel_heights = c(0.06, 0.12))
#######
#Step7#
#######
set.seed(123)
estes <- matrix(ncol=4, nrow = 200)
for(i in 1:200){
nx        <- runif(1,5,50)
x         <- rnorm(runif(1,10,50))
tx        <- t.test(x)
estes[i,] <- c(tx$estimate, tx$stderr, nx, tx$statistic)}
df7  <- data.frame(xi=1/estes[,3], y=resid(metafor::rma(estes[,1], sei=estes[,2])), z=estes[,4])
title_pl7 <- ggplot()+theme_void()+annotate("text", 0, 0, size = 6, label="Step 7")
pl7 <- ggplot(df7, aes(xi, y=y))+
geom_point(size=1, alpha=0.1)+xlab("Inverse of the sample size (1/n)\nand standard error (1/se)")+
ylab("Posterior mean model residuals")+
annotate("text", x=0.11, y=0.6, size=3, label="Residual bias check")+ylim(-.7, .7)+
geom_hline(yintercept = 0, col="dodgerblue1")+
#geom_line(data=df6, aes(xi, y), lwd=1)+
theme_classic()+
theme(axis.title = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank())
step7fig <- cowplot::plot_grid(title_pl7, pl7, ncol=1, rel_heights = c(0.25, 0.75))
#########
#Step 8.#
#########
title_pl8 <- ggplot()+theme_void()+annotate("text", 0, 0, size = 6, label="Step 8")
text_pl8 <- ggplot() +
theme_void() +
theme(plot.margin = unit(c(.1, .1, .1, .1), "cm")) +
annotate("text",
x = 0,
y = 0,
size = 3,
label = "Sensitivity analysis")
df8 <- data.frame(x=c(1,2), mu=c(-0.2, -0.4), ll=c(-1.2, -1.4), ul=c(0.8, 0.6))
pl8 <- ggplot(df8, aes(x=x, y=mu))+xlim(0, 3)+
geom_point(size=3)+coord_flip()+
geom_hline(yintercept = 0)+
geom_errorbar(aes(ymin=ll, ymax=ul), lwd=1.2, width=0)+
theme_void()
step8fig  <- cowplot::plot_grid(title_pl8, text_pl8, pl8, ncol = 1, rel_heights = c(0.25, 0.2, 0.55))
#########
#Step 9.#
#########
xvals     <- seq(-1, 1, 0.01)
postbox   <- dnorm(xvals, -0.2, 0.07)
df9       <- data.frame(x=xvals, posterior=postbox)
pointdata <- cbind.data.frame(point=-0.2, ll=-0.2+0.07*-1.9, ul=-0.2+0.07*1.9)
title_pl9 <- ggplot()+theme_void()+annotate("text", 0, 0, size = 6, label="Step 9")
pl9a <- ggplot(df9, aes(x, posterior))+
geom_line()+theme_classic()+ylab("Posterior\nprobability density")+
xlab(expression("Pooled stressor parameter estimate " * beta[s*","*pooled]))+
geom_vline(xintercept = 0, lty=2, lwd=0.2)+
geom_point(data=pointdata, aes(x=point, y=0), size=2, inherit.aes = F)+
geom_errorbarh(data=pointdata, aes(x=0, xmin=ll, xmax=ul, y=0),
height=0, lwd=1)+
theme(axis.ticks = element_blank(),
axis.text = element_blank(),
axis.title = element_blank())
x    <- seq(1, 10, .1)
examphops <- list()
for(i in 1:1000){
b1   <- rnorm(1,-0.2, 0.07)
b0   <- rnorm(1,3.5, 0.25)
ylog <- exp(b1*x+b0)
examphops[[i]] <- cbind.data.frame(i=i, x=x, y=ylog)}
hopexamp <- do.call(rbind, examphops)
expmap <- data.frame(x=x, y=exp(-0.2*x+3.5))
pl9b <- ggplot(hopexamp, aes(x, y, group=as.factor(i)))+
geom_line(lwd=.4, alpha=0.2, col="dodgerblue1")+ylim(0, 50)+
geom_line(data=expmap, aes(x=x, y=y), col="dodgerblue4", lwd=1, inherit.aes = F)+
theme_classic()+xlab("Environmental gradient")+
theme(legend.position = "none",
axis.title.x = element_text(size=6),
axis.title.y = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank())
step9fig <- cowplot::plot_grid(title_pl9, cowplot::plot_grid(pl9a, pl9b), ncol=1, rel_heights = c(0.25, 0.75))
##############
#All together#
##############
final_fig <- ggplot(data.frame(a=1)) + xlim(0, 90) + ylim(0, 160) +
annotation_custom(ggplotGrob(step1fig), xmin = 0, xmax = 40, ymin = 143, ymax = 168) +
annotation_custom(ggplotGrob(step2fig), xmin = 50, xmax = 90, ymin = 133, ymax = 163)+
annotation_custom(ggplotGrob(eqfigbelow), xmin = 51, xmax = 91, ymin = 128, ymax = 133)+
annotation_custom(ggplotGrob(step3fig), xmin = 0, xmax = 40, ymin = 121, ymax = 136)+
annotation_custom(ggplotGrob(step4fig), xmin = 0, xmax = 40, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step5fig), xmin = 50, xmax = 90, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step6fig), xmin = 5, xmax = 85, ymin = 65, ymax = 85) +
annotation_custom(ggplotGrob(step7fig), xmin = 20, xmax = 70, ymin = 43, ymax = 68) +
annotation_custom(ggplotGrob(step8fig), xmin = 30, xmax = 60, ymin = 20, ymax = 43) +
annotation_custom(ggplotGrob(step9fig), xmin = 10, xmax = 80, ymin = -5, ymax = 20) +
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(39,39,51,51), y = c(150, 150, 145, 145)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(51,51,38,38), y = c(131, 131, 125, 125)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,20,20), y = c(123, 123,115, 115)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,40,40), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(75,75,56,56), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
theme_void()+
theme(rect = element_blank(),
line = element_blank(),
text = element_blank(),
plot.margin = unit(c(0,0,0,0), "mm"))
ggsave(final_fig, filename="C:/Users/admin/OneDrive/Bureaublad/Paper3/Figures/Fig2_method.jpeg", units = "mm", width = 180, height = 210, dpi = 300)
pl9b <- ggplot(hopexamp, aes(x, y, group=as.factor(i)))+
geom_line(lwd=.4, alpha=0.2, col="dodgerblue1")+ylim(0, 50)+
geom_line(data=expmap, aes(x=x, y=y), col="dodgerblue4", lwd=1, inherit.aes = F)+
theme_classic()+xlab("Environmental gradient")+
theme(legend.position = "none",
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank())
step9fig <- cowplot::plot_grid(title_pl9, cowplot::plot_grid(pl9a, pl9b), ncol=1, rel_heights = c(0.25, 0.75))
final_fig <- ggplot(data.frame(a=1)) + xlim(0, 90) + ylim(0, 160) +
annotation_custom(ggplotGrob(step1fig), xmin = 0, xmax = 40, ymin = 143, ymax = 168) +
annotation_custom(ggplotGrob(step2fig), xmin = 50, xmax = 90, ymin = 133, ymax = 163)+
annotation_custom(ggplotGrob(eqfigbelow), xmin = 51, xmax = 91, ymin = 128, ymax = 133)+
annotation_custom(ggplotGrob(step3fig), xmin = 0, xmax = 40, ymin = 121, ymax = 136)+
annotation_custom(ggplotGrob(step4fig), xmin = 0, xmax = 40, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step5fig), xmin = 50, xmax = 90, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step6fig), xmin = 5, xmax = 85, ymin = 65, ymax = 85) +
annotation_custom(ggplotGrob(step7fig), xmin = 20, xmax = 70, ymin = 43, ymax = 68) +
annotation_custom(ggplotGrob(step8fig), xmin = 30, xmax = 60, ymin = 20, ymax = 43) +
annotation_custom(ggplotGrob(step9fig), xmin = 10, xmax = 80, ymin = -5, ymax = 20) +
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(39,39,51,51), y = c(150, 150, 145, 145)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(51,51,38,38), y = c(131, 131, 125, 125)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,20,20), y = c(123, 123,115, 115)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,40,40), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(75,75,56,56), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
theme_void()+
theme(rect = element_blank(),
line = element_blank(),
text = element_blank(),
plot.margin = unit(c(0,0,0,0), "mm"))
ggsave(final_fig, filename="C:/Users/admin/OneDrive/Bureaublad/Paper3/Figures/Fig2_method.jpeg", units = "mm", width = 180, height = 210, dpi = 300)
final_fig <- ggplot(data.frame(a=1)) + xlim(0, 90) + ylim(0, 160) +
annotation_custom(ggplotGrob(step1fig), xmin = 0, xmax = 40, ymin = 143, ymax = 168) +
annotation_custom(ggplotGrob(step2fig), xmin = 50, xmax = 90, ymin = 133, ymax = 163) +
annotation_custom(ggplotGrob(eqfigbelow), xmin = 51, xmax = 91, ymin = 128, ymax = 133) +
annotation_custom(ggplotGrob(step3fig), xmin = 0, xmax = 40, ymin = 121, ymax = 136) +
annotation_custom(ggplotGrob(step4fig), xmin = 0, xmax = 40, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step5fig), xmin = 50, xmax = 90, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step6fig), xmin = 5, xmax = 85, ymin = 65, ymax = 85) +
annotation_custom(ggplotGrob(step7fig), xmin = 20, xmax = 70, ymin = 43, ymax = 68) +
annotation_custom(ggplotGrob(step8fig), xmin = 30, xmax = 60, ymin = 20, ymax = 43) +
annotation_custom(ggplotGrob(step9fig), xmin = 10, xmax = 80, ymin = -5, ymax = 20) +
# Add bounding boxes using geom_rect()
geom_rect(aes(xmin = 0, xmax = 40, ymin = 143, ymax = 168), color = "black", fill = NA) +
geom_rect(aes(xmin = 50, xmax = 90, ymin = 133, ymax = 163), color = "black", fill = NA) +
geom_rect(aes(xmin = 51, xmax = 91, ymin = 128, ymax = 133), color = "black", fill = NA) +
geom_rect(aes(xmin = 0, xmax = 40, ymin = 121, ymax = 136), color = "black", fill = NA) +
geom_rect(aes(xmin = 0, xmax = 40, ymin = 95, ymax = 115), color = "black", fill = NA) +
geom_rect(aes(xmin = 50, xmax = 90, ymin = 95, ymax = 115), color = "black", fill = NA) +
geom_rect(aes(xmin = 5, xmax = 85, ymin = 65, ymax = 85), color = "black", fill = NA) +
geom_rect(aes(xmin = 20, xmax = 70, ymin = 43, ymax = 68), color = "black", fill = NA) +
geom_rect(aes(xmin = 30, xmax = 60, ymin = 20, ymax = 43), color = "black", fill = NA) +
geom_rect(aes(xmin = 10, xmax = 80, ymin = -5, ymax = 20), color = "black", fill = NA) +
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(39,39,51,51), y = c(150, 150, 145, 145)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed")) +
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(51,51,38,38), y = c(131, 131, 125, 125)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed")) +
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,20,20), y = c(123, 123,115, 115)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed")) +
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,40,40), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed")) +
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(75,75,56,56), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed")) +
theme_void() +
theme(rect = element_blank(),
line = element_blank(),
text = element_blank(),
plot.margin = unit(c(0,0,0,0), "mm"))
ggsave(final_fig, filename="C:/Users/admin/OneDrive/Bureaublad/Paper3/Figures/Fig2_method.jpeg", units = "mm", width = 180, height = 210, dpi = 300)
final_fig <- ggplot(data.frame(a=1)) + xlim(0, 90) + ylim(0, 160) +
annotation_custom(ggplotGrob(step1fig), xmin = 0, xmax = 40, ymin = 143, ymax = 168) +
annotation_custom(ggplotGrob(step2fig), xmin = 50, xmax = 90, ymin = 133, ymax = 163)+
annotation_custom(ggplotGrob(eqfigbelow), xmin = 51, xmax = 91, ymin = 128, ymax = 133)+
annotation_custom(ggplotGrob(step3fig), xmin = 0, xmax = 40, ymin = 121, ymax = 136)+
annotation_custom(ggplotGrob(step4fig), xmin = 0, xmax = 40, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step5fig), xmin = 50, xmax = 90, ymin = 95, ymax = 115) +
annotation_custom(ggplotGrob(step6fig), xmin = 5, xmax = 85, ymin = 65, ymax = 85) +
annotation_custom(ggplotGrob(step7fig), xmin = 20, xmax = 70, ymin = 43, ymax = 68) +
annotation_custom(ggplotGrob(step8fig), xmin = 30, xmax = 60, ymin = 20, ymax = 43) +
annotation_custom(ggplotGrob(step9fig), xmin = 10, xmax = 80, ymin = -5, ymax = 20) +
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(39,39,51,51), y = c(150, 150, 145, 145)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(51,51,38,38), y = c(131, 131, 125, 125)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,20,20), y = c(123, 123,115, 115)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(20,20,40,40), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
geom_path(data = as.data.frame(bezier(t = 0:100/100, p = list(x = c(75,75,56,56), y = c(95, 95, 78, 78)))),
aes(x = V1, y = V2), size = 1, arrow = arrow(length = unit(.01, "npc"), type = "closed"))+
theme_void()+
theme(rect = element_blank(),
line = element_blank(),
text = element_blank(),
plot.margin = unit(c(0,0,0,0), "mm"))
ggsave(final_fig, filename="C:/Users/admin/OneDrive/Bureaublad/Paper3/Figures/Fig2_method.jpeg", units = "mm", width = 180, height = 210, dpi = 300)
