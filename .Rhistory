rm(list = setdiff(all_objects, "mod", "meta", "pdplot", "hop"))
all_objects <- ls()
rm(list = setdiff(all_objects, c("mod", "meta", "pdplot", "hop")))
rm(all_objects)
all_objects <- ls()
rm(list = setdiff(all_objects, c("mod", "meta", "pdplot", "hop")))
rm(all_objects)
order_p <- c("Salinity", "Oxygen", "Sediment", "Thermal", "Flow", "Nutrient-N", "Nutrient-P")
order_g <- c("Bacteria", "Algae", "Macrophytes", "Invertebrates", "Fish")
postdens <- pdplot(mod,order_predictor = order_p, order_group = order_g)
postdens$posterior_density$log
mod <- meta(estimate = tot_coef$y,
stderr = tot_coef$V,
method = 2,
Nsamp = tot_coef$n,
parameter = do.call(rbind, strsplit(tot_coef$level, "_"))[,1],
predictor = tot_coef$s,
link_function = tot_coef$m,
grouping = tot_coef$g,
prior_mu = as.data.frame(priors[c(2,4,6,8,10,12,14,16)]),
prior_mu_se = as.data.frame(priors[c(3,5,7,9,11,13,15,17)]),
prior_weights = c(0.125, 0.2, 0.125, 0.05, 0.125, 0.125, 0.125, 0.125),
n_iter = 15000,
n_thin = 30,
n_chain= 30)
library(readxl)
library(ggplot2)
library(R2jags)
library(tidyr)
literature <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/parameter_est3.xlsx")
priors     <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/parameters.xlsx")
table(literature[!duplicated(literature$DOI),]$sys)
unique(paste(literature$DOI, literature$`Exact response`))
#Total regression coefficients
tot_coef <- data.frame(g=literature$Response,
s=literature$Type,
level=paste(literature$Parameter, literature$Type, literature$Link, literature$Response, sep = "_"),
y=literature$estimate,
V=literature$estimate_se,
m=literature$Link,
d=literature$Source,
n=literature$n,
l=literature$mean,
sp=literature$sd,
spl=literature$sd/literature$mean)
mod <- meta(estimate = tot_coef$y,
stderr = tot_coef$V,
method = 2,
Nsamp = tot_coef$n,
parameter = do.call(rbind, strsplit(tot_coef$level, "_"))[,1],
predictor = tot_coef$s,
link_function = tot_coef$m,
grouping = tot_coef$g,
prior_mu = as.data.frame(priors[c(2,4,6,8,10,12,14,16)]),
prior_mu_se = as.data.frame(priors[c(3,5,7,9,11,13,15,17)]),
prior_weights = c(0.125, 0.2, 0.125, 0.05, 0.125, 0.125, 0.125, 0.125),
n_iter = 15000,
n_thin = 30,
n_chain= 30)
sum_mod <- mod$Summary
all_objects <- ls()
rm(list = setdiff(all_objects, c("mod", "meta", "pdplot", "hop")))
rm(all_objects)
order_p <- c("Salinity", "Oxygen", "Sediment", "Thermal", "Flow", "Nutrient-N", "Nutrient-P")
order_g <- c("Bacteria", "Algae", "Macrophytes", "Invertebrates", "Fish")
postdens <- pdplot(mod,order_predictor = order_p, order_group = order_g)
postdens$posterior_density$log
postdens$posterior_density$logit
ggsave(postdens$posterior_density$log, filename="C:/Users/admin/OneDrive/Bureaublad/Paper3/Figures/Fig_dens_log.jpeg", units = "mm", width = 200, height = 120, dpi = 300)
ggsave(postdens$posterior_density$logit, filename="C:/Users/admin/OneDrive/Bureaublad/Paper3/Figures/Fig_dens_logit.jpeg", units = "mm", width = 200, height = 120, dpi = 300)
hop1 <- hop(mod, group="Fish", predictor = "Oxygen",
xlab = expression(LN(Oxygen ~ mg ~ L^-1)),
link_function = "log",
xlimit =c(0 , 4), ylimit=c(0, 30))
hop2 <- hop(mod, group="Invertebrates", predictor = "Salinity",
xlab= expression(LN(Conductivity ~ µS ~ cm^-1)),
link_function = "logit",
xlim=c(0, 7.5), ylimit = c(0, 1))
hop3 <- hop(mod, group="Invertebrates", predictor = "Sediment",
xlab = "LN(Fine sediment %)",
link_function = "logit",
xlim=c(-3, 0), ylimit = c(0, 1))
hop4 <- hop(mod, group="Invertebrates", predictor = "Flow",
xlab = expression(LN(Velocity ~ m ~ s^-1)),
link_function = "log",
xlim=c(-3, 0.5))
hop5 <- hop(mod, group="Algae", predictor = "Nutrient-N",
xlab = expression(LN(`Nutrient-N` ~ mg ~ L^-1)),
link_function = "log",
xlim=c(-3, 3.5))
hop6 <- hop(mod, group="Invertebrates", predictor = "Thermal",
xlab = "LN(Temperature C°)",
link_function = "log",
xlim=c(.5, 3.5), ylimit = c(0, 50))
Fl <- ggplot()+theme_void()+annotate("text", 0, 0, size = 4, label="Fish (log-linear)")
Il <- ggplot()+theme_void()+annotate("text", 0, 0, size = 4, label="Invertebrates (logit-linear)")
Ii <- ggplot()+theme_void()+annotate("text", 0, 0, size = 4, label="Invertebrates (log-linear)")
Al <- ggplot()+theme_void()+annotate("text", 0, 0, size = 4, label="Algae (log-linear)")
subpl1 <- cowplot::plot_grid(Fl, Il, hop1, hop2, rel_heights = c(0.25, 0.75))
subpl2 <- cowplot::plot_grid(Il, Ii, hop3, hop4, rel_heights = c(0.25, 0.75))
subpl3 <- cowplot::plot_grid(Al, Ii, hop5, hop6, rel_heights = c(0.25, 0.75))
hopplot <- cowplot::plot_grid(subpl1, subpl2, subpl3, ncol = 1)
ggsave(hopplot, filename="C:/Users/admin/OneDrive/Bureaublad/Paper3/Figures/Fig6.jpeg", units = "mm", width = 200, height = 160, dpi = 300)
library(glmmTMB)
library(gamlss)
library(readxl)
#df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/Non_sys/10.1111_gcb.16435.xlsx")
df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/extracted data/Benlasri et al. - 2023.xlsx", sheet=1)
#df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/Non_sys/10.1111_gcb.16435.xlsx")
df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/extracted data/Benlasri et al. - 2023.xlsx", sheet=1)
#df <- na.omit(df)
t(apply(df, 2, function(x) c(mean(as.numeric(x), na.rm=T), sd(as.numeric(x), na.rm = T))))
#df$y  <- as.integer(df$ntax_dia)
#df$y   <- as.integer(as.numeric(df$cover))
#df$y  <- df$cover
#df$y <- df$even
#df$y[df$y>1] <-1
#df$y <- df$sh/max(df$sh)
#df$y   <- df$nept/df$ntaxa
#df$y <- df$`Shannon diversity`/log(df$Taxa_S)
#df$y <- df$otu
#df$y  <- df$`sensitive fish`
df$y <- vegan::specnumber(df[,c(4:ncol(df))])
View(df)
#df$fs   <- log(df$fs)
df$ec  <- log(df$ec)
#df$tn  <- log(df$tn)
#df$tp  <- log(df$tp)
#df$po4 <- log(df$po4)
#df$no3 <- log(df$no3)
df$temp <- log(df$temp)
#df$flow <- log(df$flow)
#df$vel  <- log(df$vel)
#df$dis <- log(df$dis)
df$o2  <- log(df$o2)
library(glmmTMB)
library(gamlss)
library(readxl)
#df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/Non_sys/10.1111_gcb.16435.xlsx")
df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/extracted data/Benlasri et al. - 2023.xlsx", sheet=1)
#df <- na.omit(df)
t(apply(df, 2, function(x) c(mean(as.numeric(x), na.rm=T), sd(as.numeric(x), na.rm = T))))
colnames(df)
#df$y  <- as.integer(df$ntax_dia)
#df$y   <- as.integer(as.numeric(df$cover))
#df$y  <- df$cover
#df$y <- df$even
#df$y[df$y>1] <-1
#df$y <- df$sh/max(df$sh)
#df$y   <- df$nept/df$ntaxa
#df$y <- df$`Shannon diversity`/log(df$Taxa_S)
#df$y <- df$otu
#df$y  <- df$`sensitive fish`
df$y <- vegan::specnumber(df[,c(4:ncol(df))])
#df$fs   <- log(df$fs)
df$ec  <- log(df$ec)
#df$tn  <- log(df$tn)
#df$tp  <- log(df$tp)
#df$po4 <- log(df$po4)
#df$no3 <- log(df$no3)
df$temp <- log(df$temp)
#df$flow <- log(df$flow)
#df$vel  <- log(df$vel)
#df$dis <- log(df$dis)
df$o2  <- log(df$o2)
#df$do <- log(df$do)
plot(df$ec, df$y, pch=19)
summary(mod <- glmmTMB(y~ec+o2+temp+(1|site), data=df, family = nbinom2(link="log")))
summary(mod2 <- update(mod, control=glmmTMBControl(optimizer=optim, optArgs=list(method="BFGS"))))
summary(mod <- glmmTMB(y~ec+o2+temp+(1|site)+(1|time), data=df, family = nbinom2(link="log")))
nrow(df)
library(glmmTMB)
library(gamlss)
library(readxl)
#df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/Non_sys/10.1111_gcb.16435.xlsx")
df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/extracted data/Benlasri et al. - 2023.xlsx", sheet=1)
#df <- na.omit(df)
t(apply(df, 2, function(x) c(mean(as.numeric(x), na.rm=T), sd(as.numeric(x), na.rm = T))))
#df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/Non_sys/10.1111_gcb.16435.xlsx")
df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/extracted data/Benlasri et al. - 2023.xlsx", sheet=1)
#df <- na.omit(df)
t(apply(df, 2, function(x) c(mean(as.numeric(x), na.rm=T), sd(as.numeric(x), na.rm = T))))
colnames(df)
#df$fs   <- log(df$fs)
df$ec  <- log(df$ec)
#df$tn  <- log(df$tn)
#df$tp  <- log(df$tp)
#df$po4 <- log(df$po4)
#df$no3 <- log(df$no3)
df$temp <- log(df$temp)
#df$flow <- log(df$flow)
#df$vel  <- log(df$vel)
#df$dis <- log(df$dis)
df$o2  <- log(df$o2)
#df$do <- log(df$do)
plot(df$ec, df$y, pch=19)
library(glmmTMB)
library(gamlss)
library(readxl)
#df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/Non_sys/10.1111_gcb.16435.xlsx")
df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/extracted data/Benlasri et al. - 2023.xlsx", sheet=1)
#df <- na.omit(df)
t(apply(df, 2, function(x) c(mean(as.numeric(x), na.rm=T), sd(as.numeric(x), na.rm = T))))
colnames(df)
#df$fs   <- log(df$fs)
df$ec  <- log(df$ec)
#df$y   <- as.integer(as.numeric(df$cover))
#df$y  <- df$cover
#df$y <- df$even
#df$y[df$y>1] <-1
#df$y <- df$sh/max(df$sh)
#df$y   <- df$nept/df$ntaxa
#df$y <- df$`Shannon diversity`/log(df$Taxa_S)
#df$y <- df$otu
#df$y  <- df$`sensitive fish`
#df$y <- vegan::specnumber(df[,c(4:ncol(df))])
df$y <- vegan::diversity(df[,c(4:ncol(df))])/log(vegan::specnumber(df[,c(4:ncol(df))]))
library(glmmTMB)
library(gamlss)
library(readxl)
#df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/Non_sys/10.1111_gcb.16435.xlsx")
df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/extracted data/Benlasri et al. - 2023.xlsx", sheet=1)
#df <- na.omit(df)
t(apply(df, 2, function(x) c(mean(as.numeric(x), na.rm=T), sd(as.numeric(x), na.rm = T))))
colnames(df)
#df$y   <- as.integer(as.numeric(df$cover))
#df$y  <- df$cover
#df$y <- df$even
#df$y[df$y>1] <-1
#df$y <- df$sh/max(df$sh)
#df$y   <- df$nept/df$ntaxa
#df$y <- df$`Shannon diversity`/log(df$Taxa_S)
#df$y <- df$otu
#df$y  <- df$`sensitive fish`
#df$y <- vegan::specnumber(df[,c(4:ncol(df))])
df$y <- vegan::diversity(df[,c(4:ncol(df))])/log(vegan::specnumber(df[,c(4:ncol(df))]))
df[,c(4:ncol(df))]
View(df)
#df$y   <- as.integer(as.numeric(df$cover))
#df$y  <- df$cover
#df$y <- df$even
#df$y[df$y>1] <-1
#df$y <- df$sh/max(df$sh)
#df$y   <- df$nept/df$ntaxa
#df$y <- df$`Shannon diversity`/log(df$Taxa_S)
#df$y <- df$otu
#df$y  <- df$`sensitive fish`
#df$y <- vegan::specnumber(df[,c(4:ncol(df))])
df$y <- vegan::diversity(df[,c(4:16)])/log(vegan::specnumber(df[,c(4:16)]))
library(glmmTMB)
library(gamlss)
library(readxl)
#df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/Non_sys/10.1111_gcb.16435.xlsx")
df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/extracted data/Benlasri et al. - 2023.xlsx", sheet=1)
#df <- na.omit(df)
t(apply(df, 2, function(x) c(mean(as.numeric(x), na.rm=T), sd(as.numeric(x), na.rm = T))))
colnames(df)
#df$y  <- as.integer(df$ntax_dia)
#df$y   <- as.integer(as.numeric(df$cover))
#df$y  <- df$cover
#df$y <- df$even
#df$y[df$y>1] <-1
#df$y <- df$sh/max(df$sh)
#df$y   <- df$nept/df$ntaxa
#df$y <- df$`Shannon diversity`/log(df$Taxa_S)
#df$y <- df$otu
#df$y  <- df$`sensitive fish`
#df$y <- vegan::specnumber(df[,c(4:ncol(df))])
df$y <- vegan::diversity(df[,c(4:16)])/log(vegan::specnumber(df[,c(4:16)]))
View(df)
df$`Caenis pusilla` <- as.numeric(df$`Caenis pusilla`)
#df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/Non_sys/10.1111_gcb.16435.xlsx")
df   <- read_excel("C:/Users/admin/OneDrive/Bureaublad/Paper3/extracted data/Benlasri et al. - 2023.xlsx", sheet=1)
df$`Caenis pusilla` <- as.numeric(df$`Caenis pusilla`)
#df <- na.omit(df)
t(apply(df, 2, function(x) c(mean(as.numeric(x), na.rm=T), sd(as.numeric(x), na.rm = T))))
colnames(df)
#df$y   <- as.integer(as.numeric(df$cover))
#df$y  <- df$cover
#df$y <- df$even
#df$y[df$y>1] <-1
#df$y <- df$sh/max(df$sh)
#df$y   <- df$nept/df$ntaxa
#df$y <- df$`Shannon diversity`/log(df$Taxa_S)
#df$y <- df$otu
#df$y  <- df$`sensitive fish`
#df$y <- vegan::specnumber(df[,c(4:ncol(df))])
df$y <- vegan::diversity(df[,c(4:16)])/log(vegan::specnumber(df[,c(4:16)]))
#df$fs   <- log(df$fs)
df$ec  <- log(df$ec)
#df$tn  <- log(df$tn)
#df$tp  <- log(df$tp)
#df$po4 <- log(df$po4)
#df$no3 <- log(df$no3)
df$temp <- log(df$temp)
#df$flow <- log(df$flow)
#df$vel  <- log(df$vel)
#df$dis <- log(df$dis)
df$o2  <- log(df$o2)
#df$do <- log(df$do)
plot(df$ec, df$y, pch=19)
nrow(df)
summary(mod <- glmmTMB(y~ec+o2+temp+(1|site)+(1|time), data=df, zi=~1, family = beta_family(link="logit")))
library(R2jags)
library(ggplot2)
library(readxl)
data <- read_excel("C:/Users/admin/OneDrive/Bureaublad/bias/Birk_et_al2020.xlsx")
d1 <- cbind.data.frame(yg=data$Response_group,
x=c(data$Stressor1_group, data$Stressor2_group, data$Stressor_pair),
coef=c(data$Stressor1_RegCoef, data$Stressor2_RegCoef, data$Interaction_RegCoef),
p=c(data$Stressor1_p.value,  data$Stressor2_p.value, data$Interaction_p.value))
d1$p                <- ifelse(d1$p==0, runif(length(d1$p), 0, 0.05), d1$p)
d1$x <- plyr::mapvalues(d1$x, from=c("Hydrological stress", "Morphological stress",
"Nutrient|Morphological", "Nutrient|Hydrological",
"Hydrological|Thermal"),
to=c("Habitat stress", "Habitat stress",
"Nutrient|Habitat", "Nutrient|Habitat",
"Habitat|Thermal"))
d1 <- d1[d1$x %in% c("Nutrient stress", "Habitat stress", "Thermal stress", "Nutrient|Thermal",
"Nutrient|Habitat", "Habitat|Thermal"),]
birk <- ptoz(coef = d1$coef, pi = d1$p, names=d1$x)
d2 <- read_excel("C:/Users/admin/OneDrive/Bureaublad/bias/gcb13028-sup-0002-datas2.xlsx",
sheet = "Table S1")
eff <- c(d2$`Stressor A individual effect size (Hedges d)`, d2$`Stressor B individual effect size (Hedges d)`, d2$`Interaction effect size (Hedges d)`)
se  <- c(((d2$`Variance for stressor A individual effect size`)^2/sqrt(d2$`Pooled sample size`)),
((d2$`Variance for stressor B individual effect size`)^2/sqrt(d2$`Pooled sample size`)),
((d2$`Variance for interaction effect size`)^2/sqrt(d2$`Pooled sample size`)))
#' Title
#'
#' @param coef The Effect-size
#' @param sei Standard error
#' @param zi z-value
#' @param pi p-value
#' @param names Additional names
#' @param alpha alpha level
#'
ptoz <- function(coef=NULL, sei=NULL, zi=NULL, pi=NULL, names=NULL, alpha=0.05,
absolute=F, xlim=NULL, ylim=NULL){
zint <- abs(qnorm(alpha/2))
if(!is.null(coef)){
if(!is.null(sei)){
se  <- sei
z   <- coef/se
p   <- (1-pnorm(abs(z)))*2
ll  <- coef-zint*se
ul  <- coef+zint*se}
if(!is.null(zi)){
z   <- zi
se  <- abs(coef)/abs(z)
p   <- (1-pnorm(abs(z)))*2
ll  <- coef-zint*se
ul  <- coef+zint*se}
if(!is.null(pi)){
p   <- pi
z   <- qnorm(1 - p/2)
se  <- abs(coef)/abs(z)
ll  <- coef-zint*se
ul  <- coef+zint*se}
if(!is.null(names)){
if(length(coef)!=length(names)){stop("Names has not the same lenght as the data")}else{
df <- data.frame(names=names, coef=coef, se=se, z=z, p=p, ll=ll, ul=ul)
df2 <- data.frame(coef=df$coef,
z=df$coef/df$se,
pre=1/df$se,
se=df$se,
s=names)
df2$sig <- ifelse(abs(df2$z)>abs(zint),"sig","nonsig")
df2     <- df2[!(is.infinite(df2$coef) | is.infinite(df2$pre)),]
spldf   <- split(df2, df2$s)
rcoef             <- quantile(abs(df2$coef), c(.005, .995))
yl_pos            <- seq(0, ifelse(!is.null(ylim), ylim[2], rcoef[2]), length.out=50)
yl_neg            <- seq(0, ifelse(!is.null(ylim), ylim[1], -1*rcoef[2]), length.out=50)
sigline_pos       <- data.frame(coef=yl_pos, se=abs(yl_pos/1.96))
sigline_neg       <- data.frame(coef=yl_neg, se=abs(yl_neg/1.96))
sigline_pos$linvse<- 1/sigline_pos$se
sigline_neg$linvse<- 1/sigline_neg$se
if(!is.null(ylim)){ylim_plot <- ylim(ylim)}else{ylim_plot <- NULL}
if(!is.null(xlim)){xlim_plot <- xlim(xlim)}else{xlim_plot <- NULL}
if(absolute==F){
plot1 <- ggplot(df2, aes(x=pre, y=coef, col=sig))+
geom_point(alpha=0.4)+xlab("1/se")+ylab("Est.")+ylim_plot+xlim_plot+
geom_line(data=sigline_pos, aes(linvse, coef), lty=2, col="tomato4")+
geom_line(data=sigline_neg, aes(linvse, coef), lty=2, col="tomato4")+
geom_hline(yintercept = 0, lty=3, col="tomato4")+
scale_color_manual(breaks = c("sig", "nonsig"),
values = c("tomato3", "dodgerblue3"))+
theme_classic()+
facet_wrap(.~s, scales = "free")+
theme(legend.position = "none")}else{
plot1 <- ggplot(df2, aes(x=pre, y=abs(coef), col=sig))+
geom_point(alpha=0.4)+xlab("1/se")+ylab("|Est.|")+ylim_plot+xlim_plot+
geom_line(data=sigline_pos, aes(linvse, coef), lty=2, col="tomato4")+
geom_hline(yintercept = 0, lty=3, col="tomato4")+
scale_color_manual(breaks = c("sig", "nonsig"),
values = c("tomato3", "dodgerblue3"))+
theme_classic()+
facet_wrap(.~s, scales = "free")+
theme(legend.position = "none")}
}
}else{df    <- data.frame(names=1:length(coef), coef=coef, se=se, z=z, p=p, ll=ll, ul=ul)
plot1 <- NULL}
}else{
if(!is.null(zi)){
z   <- zi
p   <- (1-pnorm(abs(z)))*2}
if(!is.null(pi)){
p   <- pi
z   <- qnorm(1 - p/2)}
if(!is.null(names)){
if(length(p)!=length(names)){stop("Names has not the same lenght as the data")}else{
df       <- data.frame(names=names, z=z, p=p)
plot1    <- NULL
}
}else{df       <- data.frame(names=1:length(p), z=z, p=p)
plot1          <- NULL}
if(!is.null(zi) | !is.null(pi)){
}else{stop("Either z- or p-values need to be provided")}}
cninfnan <- function(x){!any(is.na(x), is.infinite(x), is.nan(x))}
vec      <- rep(NA, nrow(df))
for(i in 1:nrow(df)){
vec[i] <- cninfnan(df$se[i])}
df                 <- df[vec,]
df$z[is.nan(df$z)] <- 0
return(list(data=df, funnel_plot=plot1))}
data <- read_excel("C:/Users/admin/OneDrive/Bureaublad/bias/Birk_et_al2020.xlsx")
d1 <- cbind.data.frame(yg=data$Response_group,
x=c(data$Stressor1_group, data$Stressor2_group, data$Stressor_pair),
coef=c(data$Stressor1_RegCoef, data$Stressor2_RegCoef, data$Interaction_RegCoef),
p=c(data$Stressor1_p.value,  data$Stressor2_p.value, data$Interaction_p.value))
d1$p                <- ifelse(d1$p==0, runif(length(d1$p), 0, 0.05), d1$p)
d1$x <- plyr::mapvalues(d1$x, from=c("Hydrological stress", "Morphological stress",
"Nutrient|Morphological", "Nutrient|Hydrological",
"Hydrological|Thermal"),
to=c("Habitat stress", "Habitat stress",
"Nutrient|Habitat", "Nutrient|Habitat",
"Habitat|Thermal"))
d1 <- d1[d1$x %in% c("Nutrient stress", "Habitat stress", "Thermal stress", "Nutrient|Thermal",
"Nutrient|Habitat", "Habitat|Thermal"),]
birk <- ptoz(coef = d1$coef, pi = d1$p, names=d1$x)
d2 <- read_excel("C:/Users/admin/OneDrive/Bureaublad/bias/gcb13028-sup-0002-datas2.xlsx",
sheet = "Table S1")
eff <- c(d2$`Stressor A individual effect size (Hedges d)`, d2$`Stressor B individual effect size (Hedges d)`, d2$`Interaction effect size (Hedges d)`)
se  <- c(((d2$`Variance for stressor A individual effect size`)^2/sqrt(d2$`Pooled sample size`)),
((d2$`Variance for stressor B individual effect size`)^2/sqrt(d2$`Pooled sample size`)),
((d2$`Variance for interaction effect size`)^2/sqrt(d2$`Pooled sample size`)))
d2 <- data.frame(e=eff, se=se, s=c(d2$`Stressor A`, d2$`Stressor B`, d2$`Stressor pair`))
d2 <- d2[d2$s %in% c("Temperature", "Nutrification", "Habitat Alteration",
"Nutrification x Warming", "Habitat Alteration x Nutrification",  "Habitat Alteration x Warming"),]
d2$s <- plyr::mapvalues(d2$s, from=c("Temperature", "Nutrification", "Habitat Alteration",
"Nutrification x Warming", "Habitat Alteration x Nutrification",
"Habitat Alteration x Warming"),
to=c("Thermal stress", "Nutrient stress", "Habitat stress", "Nutrient|Thermal",
"Habitat|Nutrient", "Habitat|Thermal"))
jackson <- ptoz(coef = d2$e, sei = d2$se, names=d2$s, ylim=c(-10, 10), xlim=c(0, 50))
df <- read_excel("C:/Users/admin/OneDrive/Bureaublad/bias/Crain_et_al_2008_doi_10.1111_j.1461-0248.2008.01253.x.xlsx",
sheet = "Sheet1")
d3 <- data.frame(y=as.numeric(df$`Interaction Effect`),
se=abs((as.numeric(df$`Interaction upper CI`)-as.numeric(df$`Interaction Effect`))/1.96),
int=paste0(df$`Stress A`,"|",df$`Stress B`))
d3 <- d3[!is.na(d3$se),]
d3 <- d3[d3$int %in% "nutrient|temp",]
d3$int <- "Nutrient|Thermal"
crain <- ptoz(coef=d3$y, sei=d3$se, names = d3$int)
total_df <- data.frame(coef=c(birk$data$coef, jackson$data$coef, crain$data$coef),
stress=c(birk$data$names, jackson$data$names, crain$data$names),
se=c(birk$data$se, jackson$data$se, crain$data$se),
study=c(rep("Birk et al. (2020)", nrow(birk$data)),
rep("Jackson et al. (2016)", nrow(jackson$data)),
rep("Crain et al. (2008)", nrow(crain$data))))
total_df$All <- "All"
all <- ptoz(coef=total_df$coef, sei=total_df$se, names = total_df$All, ylim=c(-10, 10), xlim=c(0, 30))
all$funnel_plot
all$study <- total_df$study
dataz <- all$data
plhist1 <- ggplot(data.frame(z=dataz$z), aes(z))+xlim(-10, 10)+
xlab("z-value")+geom_vline(xintercept = c(-1*qnorm(1 - .05/2), qnorm(1 - .05/2)), lwd=1, col="tomato3", lty=2)+
geom_histogram(col="black", fill="grey70",
position="identity",
binwidth = 0.5,
boundary = 0, closed = "left")+
theme_classic()
plhist2 <- ggplot(data.frame(z=dataz$z), aes(abs(z)))+xlim(0, 10)+
xlab("z-value")+geom_vline(xintercept = qnorm(1 - .05/2), lwd=1, col="tomato3", lty=2)+
geom_histogram(col="black", fill="grey70",
alpha=0.5, position="identity",
binwidth = 0.5,
boundary = 0, closed = "left")+
theme_classic()
fig4 <- cowplot::plot_grid(plhist1, plhist2, ncol=1, rel_heights = c(0.3, 0.7), labels = "AUTO", label_size = 10)
ggsave(fig4, filename = "C:/Users/admin/OneDrive/Bureaublad/bias/Fig4.JPEG",
width = 155, height = 120, units = "mm")
fig4
plhist1 <- ggplot(data.frame(z=dataz$z), aes(z))+xlim(-10, 10)+
xlab("z-value")+
geom_histogram(col="black", fill="grey70",
position="identity",
binwidth = 0.5,
boundary = 0, closed = "left")+
geom_vline(xintercept = c(-1*qnorm(1 - .05/2), qnorm(1 - .05/2)), lwd=1, col="tomato3", lty=2)+
theme_classic()
plhist2 <- ggplot(data.frame(z=dataz$z), aes(abs(z)))+xlim(0, 10)+
xlab("z-value")+
geom_histogram(col="black", fill="grey70",
alpha=0.5, position="identity",
binwidth = 0.5,
boundary = 0, closed = "left")+
geom_vline(xintercept = qnorm(1 - .05/2), lwd=1, col="tomato3", lty=2)+
theme_classic()
fig4 <- cowplot::plot_grid(plhist1, plhist2, ncol=1, rel_heights = c(0.3, 0.7), labels = "AUTO", label_size = 10)
fig4
ggsave(fig4, filename = "C:/Users/admin/OneDrive/Bureaublad/bias/Fig4.JPEG",
width = 155, height = 120, units = "mm")
